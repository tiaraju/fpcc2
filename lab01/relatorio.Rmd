---
title: "Lab 01 - FPCC 2"
author: "Tiaraju Smaneoto"
output: html_notebook
---

```{r echo = FALSE}
library(dplyr, warn.conflicts = F)
library(readr)
library(ggplot2)
library(gmodels)
library(stringr)
```

#Questões a serem respondidas:

####a. Em que tipo de despesas os parlamentares gastam mais recursos de sua cota?


####b. Que tipos de despesa tem valores que mais variam quando comparamos os deputados? 

-------

#Dados
Os dados que serão analisados serão restringidos aos deputados baianos. 

Primeiramente, vamos observar os tipos de gasto mais frequentes entre os deputados da Bahia.
Para isso, analisaremos a variável txtDescricao, que especifica a descrição do gasto. Agruparemos por tal variável para contar o número de ocorrências.

Uma ressalva importante é que tivemos que fazer merge das variáveis Emissão de Bilhete Aéreo e Passagens Aéreas, uma vez que, no contexto da análise, os dois se referem ao mesmo tipo gasto.

```{r}
dados = read.csv("dados//AnoAtual.csv")  %>% filter(sgUF=="BA")

dados$txtDescricao[dados$txtDescricao == "Emissão Bilhete Aéreo"] <- "PASSAGENS AÉREAS"
dados$numSubCota[dados$numSubCota == 9] <- 999
dados = dados %>% mutate(txtDescricao=str_to_title(txtDescricao))
dados %>%  ggplot() + geom_bar(mapping=aes(x=txtDescricao)) + coord_flip()
```
Podemos observar que, em número de observações, Combustíveis e lubrificantes é o tipo de despesa que mais aparece, seguido por Emissão de bilhete aéreo.


Agora, respondendo a primeira questão, vamos observar onde se concentram os maiores gastos.
Para tal, analisaremos a variável vlrLiquido agrupada por tipo de descrição.

O resultado é mostrado no gráfico abaixo:

```{r}
gasto_por_desc <- aggregate(dados$vlrLiquido ~ dados$txtDescricao, dados, sum)

gasto_por_desc <- gasto_por_desc %>% select(descricao=`dados$txtDescricao`, valorLiquido=`dados$vlrLiquido`)
#paleta de cores 
cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7"
                , "#00008B", "#E7298A", "#00FF00", "#FF0000", "#545454", "#0000FF", "#E6AB02")
  
gasto_por_desc %>% ggplot(aes(x=reorder(descricao,-valorLiquido), y=valorLiquido, fill=reorder(descricao,-valorLiquido) )) +
  geom_bar(stat="identity") + theme(axis.title.x=element_blank(), axis.text.x=element_blank(),axis.ticks.x=element_blank())+ scale_fill_manual(values=cbbPalette, name="Descrição") 

```
Podemos observar que os três tipos de despesas onde os parlamentares mais gastam seus recursos são:

* Divulgação de atividade parlamentar
* Passagens Aéreas
* Locação ou fretamento de Veículos

####b. Que tipos de despesa tem valores que mais variam quando comparamos os deputados? 


Agora, respondendo à segunda questão:

```{r}
  dados_por_despesa = dados %>% group_by(txNomeParlamentar, txtDescricao) %>% summarise(vlrLiquido=sum(vlrLiquido))# %>% group_by(txtDescricao,txNomeParlamentar) %>% summarise(vlrLiquido=sum(vlrLiquido))
  dados_por_despesa %>% View()
```



